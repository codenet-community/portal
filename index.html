<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codenet Portal</title>
    <link rel="stylesheet" href="./style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/7.14.1-0/firebase-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/7.14.1-0/firebase-database.js"></script>
    <link rel="icon" type="image/x-icon" href="logo_white.ico">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: white;
            margin: 0;
            padding: 0;
        }

        .container {
            width: 90%;
            max-width: 600px;
            margin: 50px auto;
            background: #1e1e1e;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
        }

        .title {
            text-align: center;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .form {
            display: flex;
            flex-direction: column;
        }

        .inputBox {
            margin-bottom: 15px;
        }

        .inputBox label {
            display: block;
            margin-bottom: 5px;
        }

        .inputBox input,
        .inputBox select {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background: #252525;
            color: white;
        }

        .btn button {
            width: 100%;
            padding: 10px;
            /* background-color: #6200ee; */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .btn button:hover {
            /* background-color: #3700b3; */
        }

        #successMessage {
            margin-top: 20px;
            padding: 10px;
            background: #2e7d32;
            border-radius: 5px;
            text-align: center;
        }

        #successMessage p {
            margin: 0;
        }

        #googleFormLink {
            color: white;
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="title"><img src="logo_white.png" class="logo" alt="">CodeNet Quests</h1>
        <form action="" id="questPortalForm" class="form">
            <div class="inputBox">
                <label for="userName">Name</label>
                <input type="text" id="userName" placeholder="Enter your name" required />
            </div>

            <div class="inputBox">
                <label for="categorySelect">Quest Category</label>
                <select id="categorySelect" required>
                    <option value="" disabled selected>Select Category</option>
                    <option value="Programming">Programming</option>
                    <option value="Design">Design</option>
                    <option value="Writing">Writing</option>
                    <option value="Marketing">Marketing</option>
                    <option value="Management">Management</option>
                </select>
            </div>

            <div class="inputBox">
                <label for="questSelect">Quest</label>
                <select id="questSelect" required>
                    <option value="" disabled selected>Select Quest</option>
                </select>
            </div>

            <div class="btn">
                <button type="submit" class="submitBtn">Download Quest</button>
            </div>
        </form>

        <div id="successMessage" style="display: none; margin-top: 20px; color: white;">
            <p>
                <strong>Success!</strong> Your quest details have been stored in the backend.
            </p>
            <p>
                <strong>Download Time:</strong> <span id="downloadTime"></span>
            </p>
            <p>
                <strong>Submission Deadline:</strong> 
                <span id="submissionDeadline"></span> 
                | <a href="" target="_blank" id="googleFormLink" style="color: white; text-decoration: underline;">Submit via Google Form</a>
            </p>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBjWCAC_gazDGfozuqC3VOdCYazK_UdPP8",
            authDomain: "portal-bce40.firebaseapp.com",
            databaseURL: "https://portal-bce40-default-rtdb.firebaseio.com/",
            projectId: "portal-bce40",
            storageBucket: "portal-bce40.firebasestorage.app",
            messagingSenderId: "338576186844",
            appId: "1:338576186844:web:1afb2ea6f4464f84708319",
            measurementId: "G-BZ3K2HF01W"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const questsportalDB = firebase.database().ref("questsPortal");

        const quests = {
            "Programming": ["Python Basics", "Web Development", "Data Structures"],
            "Design": ["UI/UX Design", "Graphic Design", "Logo Creation"],
            "Writing": ["Content Writing", "Blog Posts", "Copywriting"],
            "Marketing": ["Social Media Campaign", "SEO Optimization", "Email Marketing"],
            "Management": ["Task Coordination", "Event Planning", "Team Management"]
        };

        // Populate quests based on category selection
        document.getElementById("categorySelect").addEventListener("change", function () {
            const category = this.value;
            const questSelect = document.getElementById("questSelect");

            questSelect.innerHTML = '<option value="" disabled selected>Select Quest</option>';

            if (quests[category]) {
                quests[category].forEach((quest) => {
                    const option = document.createElement("option");
                    option.value = quest;
                    option.textContent = quest;
                    questSelect.appendChild(option);
                });
            }
        });

        // Handle form submission
        document.getElementById("questPortalForm").addEventListener("submit", function (event) {
            event.preventDefault();

            const userName = getElementVal("userName");
            const category = getElementVal("categorySelect");
            const quest = getElementVal("questSelect");

            if (!userName || !category || !quest) {
                alert("All fields are required!");
                return;
            }

            saveBooking(userName, category, quest);
        });

        // Save booking to Firebase and show success message
        function saveBooking(userName, category, quest) {
            const questRef = questsportalDB.child(`${category}/${quest}`);
            const downloadTime = new Date();
            const deadline = new Date();
            deadline.setDate(downloadTime.getDate() + 3);

            questRef.set({
                userName: userName,
                downloadedAt: downloadTime.toString(),
                submissionDeadline: deadline.toString()
            }).then(() => {
                const formattedDownloadTime = downloadTime.toLocaleString();
                const formattedDeadline = deadline.toLocaleString();

                document.getElementById("downloadTime").innerText = formattedDownloadTime;
                document.getElementById("submissionDeadline").innerText = formattedDeadline;
                document.getElementById("googleFormLink").href = "https://forms.google.com";
                document.getElementById("successMessage").style.display = "block";

                // Trigger file download
                const downloadLink = document.createElement("a");
                downloadLink.href = `./quests/${quest}.pdf`;
                downloadLink.download = `${quest}.pdf`;
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
            }).catch((error) => {
                console.error("Error saving data:", error);
                alert("An error occurred while saving the booking.");
            });
        }

        // Helper function to get input values
        function getElementVal(id) {
            return document.getElementById(id).value;
        }
    </script>
</body>

</html>
