<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codenet Portal</title>
    <link rel="stylesheet" href="./style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/7.14.1-0/firebase-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/7.14.1-0/firebase-database.js"></script>
    <link rel="icon" type="image/x-icon" href="logo_white.ico">
</head>

<body>

    <!-- pre-loader -->
    <div class="preloader">
        <h2 class="load_title text"></h2>
        
        <div class="loader_content">

            <img src="./images/Dark-mode-no-bg.png" alt="" width="300px" height="150px"> 
        
        

            <svg version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <path opacity="0.3">
                <animate attributeName="d" dur="1s" repeatCount="indefinite"
                    values="M12 2 Q9 2.2 7.3 7 Q6.5 9.5 6.5 12 Q6.5 15 7.3 17 Q9 22 12 22;M12 2 Q6.5 2.2 3.3 7 Q2 9.5 2 12 Q2 15 3.4 17 Q6.5 22 12 22;"
                />
                </path>
                <path opacity="0.3">
                <animate attributeName="d" dur="1s" repeatCount="indefinite"
                    values="M12 2 Q12 2.2 12 7 Q12 9.5 12 12 Q12 15 12 17 Q12 22 12 22;M12 2 Q9 2.2 7.3 7 Q6.5 9.5 6.5 12 Q6.5 15 7.3 17 Q9 22 12 22;"
                />
                </path>
                <path opacity="0.3">
                <animate attributeName="d" dur="1s" repeatCount="indefinite"
                    values="M12 2 Q15 2.2 16.6 7 Q17.5 9.5 17.5 12 Q17.5 15 16.7 17 Q15 22 12 22;M12 2 Q12 2.2 12 7 Q12 9.5 12 12 Q12 15 12 17 Q12 22 12 22;"
                />
                </path>
                <path opacity="0.3">
                <animate attributeName="d" dur="1s" repeatCount="indefinite"
                    values="M12 2 Q17.5 2.2 20.7 7 Q22 9.5 22 12 Q22 15 20.6 17 Q17.5 22 12 22;M12 2 Q15 2.2 16.6 7 Q17.5 9.5 17.5 12 Q17.5 15 16.7 17 Q15 22 12 22;"
                />
                </path>

                <circle cx="12" cy="12" r="10" />
                <path d="M2.4 8.6 Q6 7.1 12 7 Q18 7.1 21.6 8.6" />
                <path d="M2.4 15.2 Q6 17.1 12 17.2 Q17 17.1 21.6 15.2" />

                <path>
                <animate attributeName="d" dur="1s" repeatCount="indefinite"
                    values="M12 2 Q6.5 2.2 3.3 7 Q2 9.5 2 12 Q2 15 3.4 17 Q6.5 22 12 22;M12 2 Q9 2.2 7.3 7 Q6.5 9.5 6.5 12 Q6.5 15 7.3 17 Q9 22 12 22;"
                />
                </path>
                <path>
                <animate attributeName="d" dur="1s" repeatCount="indefinite"
                    values="M12 2 Q9 2.2 7.3 7 Q6.5 9.5 6.5 12 Q6.5 15 7.3 17 Q9 22 12 22;M12 2 Q12 2.2 12 7 Q12 9.5 12 12 Q12 15 12 17 Q12 22 12 22;"
                />
                </path>
                <path>
                <animate attributeName="d" dur="1s" repeatCount="indefinite"
                    values="M12 2 Q12 2.2 12 7 Q12 9.5 12 12 Q12 15 12 17 Q12 22 12 22;M12 2 Q15 2.2 16.6 7 Q17.5 9.5 17.5 12 Q17.5 15 16.7 17 Q15 22 12 22;"
                />
                </path>
                <path>
                <animate attributeName="d" dur="1s" repeatCount="indefinite"
                    values="M12 2 Q15 2.2 16.6 7 Q17.5 9.5 17.5 12 Q17.5 15 16.7 17 Q15 22 12 22;M12 2 Q17.5 2.2 20.7 7 Q22 9.5 22 12 Q22 15 20.6 17 Q17.5 22 12 22;"
                />
                </path>
            </svg>
        </div>

    </div>



    <!-- main -->
    <div class="container">
        <h1 class="title"><img src="logo_white.png" class="logo" alt="">CodeNet Quests</h1>
        <form action="" id="questPortalForm" class="form">
            <div class="inputBox">
                <label for="userName">Name</label>
                <input type="text" id="userName" placeholder="Enter your name" required />
            </div>

            <div class="inputBox">
                <label for="categorySelect">Quest Category</label>
                <select id="categorySelect" required>
                    <option value="" disabled selected>Select Category</option>
                    <option value="Frontend">Frontend </option>
                    <option value="Backend">Backend </option>
                    <option value="Ui_Ux">UI & UX</option>
                    <option value="Game_dev">Game Development</option>
                    <option value="App_Dev">App Development</option>
                    <option value="competitive_prog">Competitive Programming</option>
                    
                </select>
            </div>

            <div class="inputBox">
                <label for="questSelect">Quest</label>
                <select id="questSelect" required>
                    <option value="" disabled selected>Select Quest</option>
                </select>
            </div>

            <div class="btn">
                <button type="submit" class="submitBtn">Download Quest</button>
            </div>
        </form>

        <div id="successMessage" style="display: none; margin-top: 20px; color: white;">
            <p>
                <strong>Success!</strong> Your quest details have been stored in the backend.
            </p>
            <p>
                <strong>Download Time:</strong> <span id="downloadTime"></span>
            </p>
            <p>
                <strong>Submission Deadline:</strong> 
                <span id="submissionDeadline"></span> 
                | <a href="" target="_blank" id="googleFormLink"></a>
            </p>
        </div>
    </div>

    <div class="info_container">
        <div class="btn">
            <label for="exportCategory">Select Category:</label>
            <select id="exportCategory">
                <option value="" selected>All Categories</option>
                <option value="Frontend">Frontend</option>
                <option value="Backend">Backend</option>
                <option value="Ui_Ux">UI & UX</option>
                <option value="Game_dev">Game Development</option>
                <option value="App_Dev">App Development</option>
                <option value="competitive_prog">Competitive Programming</option>
            </select>
            <button type="button" class="exportBtn" onclick="exportToExcel()">Export to Excel</button>
        </div>
    </div>

    
    

    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

    <script>



    // ——————————————————————————————————————————————————
    //              Firebase configuration
    // ——————————————————————————————————————————————————


        
        const firebaseConfig = {
            apiKey: "AIzaSyBjWCAC_gazDGfozuqC3VOdCYazK_UdPP8",
            authDomain: "portal-bce40.firebaseapp.com",
            databaseURL: "https://portal-bce40-default-rtdb.firebaseio.com/",
            projectId: "portal-bce40",
            storageBucket: "portal-bce40.firebasestorage.app",
            messagingSenderId: "338576186844",
            appId: "1:338576186844:web:1afb2ea6f4464f84708319",
            measurementId: "G-BZ3K2HF01W"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const questsportalDB = firebase.database().ref("questsPortal");

        const quests = {
            "Frontend": ["HTML_Basics_Your_First_Webpage"],
            "Backend": [],
            "Ui_Ux": ["UI_UX_DESIGN-1"],
            "Game_dev": [],
            "App_Dev": [],
            "competitive_prog": []
        };

        // Populate quests based on category selection
        document.getElementById("categorySelect").addEventListener("change", function () {
            const category = this.value;
            const questSelect = document.getElementById("questSelect");

            questSelect.innerHTML = '<option value="" disabled selected>Select Quest</option>';

            if (quests[category]) {
                quests[category].forEach((quest) => {
                    const option = document.createElement("option");
                    option.value = quest;
                    option.textContent = quest;
                    questSelect.appendChild(option);
                });
            }
        });

        // Handle form submission
        document.getElementById("questPortalForm").addEventListener("submit", function (event) {
            event.preventDefault();

            const userName = getElementVal("userName");
            const category = getElementVal("categorySelect");
            const quest = getElementVal("questSelect");

            if (!userName || !category || !quest) {
                alert("All fields are required!");
                return;
            }

            saveBooking(userName, category, quest);
        });

        
    // ——————————————————————————————————————————————————
    // Save booking to Firebase and trigger file download
    // ——————————————————————————————————————————————————



        function saveBooking(userName, category, quest) {
        const questRef = questsportalDB.child(category);
        const newEntryRef = questRef.push();

        const downloadTime = new Date();
        const deadline = new Date();
        deadline.setDate(downloadTime.getDate() + 7);

        // Function to format the date and time
        function formatISTDateTime(date) {
            const options = {
                weekday: 'short', // e.g., Mon
                year: 'numeric',  // e.g., 2024
                month: 'short',   // e.g., Dec
                day: '2-digit',   // e.g., 30
                timeZone: 'Asia/Kolkata',
                timeZoneName: 'short'
            };

            const timeOptions = {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true,
                timeZone: 'Asia/Kolkata'
            };

            const datePart = date.toLocaleDateString('en-US', options);
            const timePart = date.toLocaleTimeString('en-US', timeOptions);

            return `(${datePart}) At (  ${timePart})`;
        }

        // Format both downloadTime and deadline before saving to Firebase
        const formattedDownloadTime = formatISTDateTime(downloadTime);
        const formattedDeadline = formatISTDateTime(deadline);

        newEntryRef.set({
            userName: userName,
            quest: quest,
            downloadedAt: formattedDownloadTime, // Store formatted time
            submissionDeadline: formattedDeadline // Store formatted deadline
        }).then(() => {
            // Update the UI with the formatted times
            document.getElementById("downloadTime").innerText = formattedDownloadTime;
            document.getElementById("submissionDeadline").innerText = formattedDeadline;
            document.getElementById("googleFormLink").href = "#"; // Add the Google Forms link here
            document.getElementById("successMessage").style.display = "block";

            // Trigger file download
            const downloadLink = document.createElement("a");
            downloadLink.href = `./quests/${quest}.pdf`;
            downloadLink.download = `${quest}.pdf`;
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        }).catch((error) => {
            console.error("Error saving data:", error);
            alert("An error occurred while downloading.");
        });
    }


        // Helper function to get input values
        function getElementVal(id) {
            return document.getElementById(id).value;
        }



    // ——————————————————————————————————————————————————
    //                  EXCEL CONNECTIVITY
    // ——————————————————————————————————————————————————


        // Function to export Firebase data to Excel
        function exportToExcel() {
            const category = document.getElementById("exportCategory").value; // Selected category
            const questRef = category ? questsportalDB.child(category) : questsportalDB; // Reference all or specific

            // Fetch data from Firebase
            questRef.once("value")
                .then((snapshot) => {
                    const data = snapshot.val();

                    if (!data) {
                        alert("No data available.");
                        return;
                    }

                    // Prepare data for Excel
                    const rows = [];

                    // Header row
                    rows.push(["Key", "Name", "Quest", "Downloaded At", "Submission Deadline"]);

                    // Populate rows with data
                    Object.entries(data).forEach(([key, value]) => {
                        if (typeof value === 'object') { // Ensure value is a valid object
                            rows.push([
                                key,
                                value.userName || "N/A",
                                value.quest || "N/A",
                                value.downloadedAt || "N/A",
                                value.submissionDeadline || "N/A"
                            ]);
                        }
                    });

                    // Create a workbook and a worksheet
                    const workbook = XLSX.utils.book_new();
                    const worksheet = XLSX.utils.aoa_to_sheet(rows);
                    const sheetName = category || "All_Categories";
                    XLSX.utils.book_append_sheet(workbook, worksheet, sheetName);

                    // Write the Excel file and trigger download
                    const excelFileName = `${sheetName}_data.xlsx`;
                    XLSX.writeFile(workbook, excelFileName);
                })
                .catch((error) => {
                    console.error("Error fetching data for export:", error);
                    alert("An error occurred while fetching data for export.");
                });
        }

                    
            


    // ——————————————————————————————————————————————————
    //                  PRE-LOADER
    // ——————————————————————————————————————————————————



        // Preloader page loading

        var loader = document.querySelector(".preloader");

        window.addEventListener("load", ()=>{
            loader.style.display = "none";
        });


// Text Effect

        class TextScramble {
        constructor(el) {
            this.el = el;
            this.chars = "!<>-_\\/[]{}—=+*^?#__@^%%$&()";
            this.update = this.update.bind(this);
        }
        setText(newText) {
            const oldText = this.el.innerText;
            const length = Math.max(oldText.length, newText.length);
            const promise = new Promise(resolve => this.resolve = resolve);
            this.queue = [];
            for (let i = 0; i < length; i++) {
            const from = oldText[i] || '';
            const to = newText[i] || '';
            const start = Math.floor(Math.random() * 70);
            const end = start + Math.floor(Math.random() * 70);
            this.queue.push({ from, to, start, end });
            }
            cancelAnimationFrame(this.frameRequest);
            this.frame = 0;
            this.update();
            return promise;
        }
        update() {
            let output = "";
            let complete = 0;
            for (let i = 0, n = this.queue.length; i < n; i++) {
            let { from, to, start, end, char } = this.queue[i];
            if (this.frame >= end) {
                complete++;
                output += to;
            } else if (this.frame >= start) {
                if (!char || Math.random() < 0.28) {
                char = this.randomChar();
                this.queue[i].char = char;
                }
                output += `<span class="dud">${char}</span>`;
            } else {
                output += from;
            }
            }
            this.el.innerHTML = output;
            if (complete === this.queue.length) {
            this.resolve();
            } else {
            this.frameRequest = requestAnimationFrame(this.update);
            this.frame++;
            }
        }
        randomChar() {
            return this.chars[Math.floor(Math.random() * this.chars.length)];
        }}



            const phrases = [
            "WE",
        "WELCOME",
        "YOU!!!"];


        const el = document.querySelector(".text");
        const fx = new TextScramble(el);

        let counter = 0;
        const next = () => {
            fx.setText(phrases[counter]).then(() => {
                setTimeout(next, 1000);
            });
            counter = (counter + 1) % phrases.length;
        };

        next();



    </script>
    

</body>
</html>





<!-- things to do more -->

<!-- 

add proper css

-->




















